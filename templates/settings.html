{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –î–æ–º–∞—à–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('settings_save') }}">
                    <p class="text-muted mb-4">
                        –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π.
                    </p>

                    <div class="mb-3">
                        <label for="default_round_count" class="form-label">
                            –ß–∏—Å–ª–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é <span class="text-danger">*</span>
                        </label>
                        <input type="number"
                               class="form-control"
                               id="default_round_count"
                               name="default_round_count"
                               value="{{ prefs.default_round_count if prefs else 3 }}"
                               min="1"
                               max="99"
                               required>
                        <div class="form-text">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</div>
                    </div>

                    <div class="mb-3">
                        <label for="default_repeat_count" class="form-label">
                            –ß–∏—Å–ª–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é <span class="text-danger">*</span>
                        </label>
                        <input type="number"
                               class="form-control"
                               id="default_repeat_count"
                               name="default_repeat_count"
                               value="{{ prefs.default_repeat_count if prefs else 10 }}"
                               min="1"
                               max="999"
                               required>
                        <div class="form-text">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ</div>
                    </div>

                    <div class="mb-4">
                        <label for="default_rest_seconds" class="form-label">
                            –í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞ –≤ —Å–µ–∫. –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é <span class="text-danger">*</span>
                        </label>
                        <input type="number"
                               class="form-control"
                               id="default_rest_seconds"
                               name="default_rest_seconds"
                               value="{{ prefs.default_rest_seconds if prefs else 60 }}"
                               min="0"
                               max="9999"
                               required>
                        <div class="form-text">–í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞ –º–µ–∂–¥—É –ø–æ–¥—Ö–æ–¥–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö</div>
                    </div>

                    <div class="mb-4">
                        <label for="default_warmup_rest_seconds" class="form-label">
                            –í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞ –ø–æ—Å–ª–µ —Ä–∞–∑–º–∏–Ω–∫–∏ –≤ —Å–µ–∫. <span class="text-danger">*</span>
                        </label>
                        <input type="number"
                               class="form-control"
                               id="default_warmup_rest_seconds"
                               name="default_warmup_rest_seconds"
                               value="{{ prefs.default_warmup_rest_seconds if prefs else 120 }}"
                               min="0"
                               max="9999"
                               required>
                        <div class="form-text">–í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–∑–º–∏–Ω–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö</div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('index') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        </button>
                    </div>
                </form>
            </div>
        </div>

        {% if prefs %}
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
            </div>
            <div class="card-body">
                <p class="text-muted">
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π.
                </p>
            </div>
        </div>
        {% endif %}

        <!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ –±—ç–∫–∞–ø–∞–º–∏ -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">üóÑÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</h5>
            </div>
            <div class="card-body">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö -->
                {% if db_info.exists %}
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0">üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ë–î</h6>
                            </div>
                            <div class="card-body">
                                <p class="mb-1">
                                    <strong>–†–∞–∑–º–µ—Ä:</strong>
                                    {% if db_info.size < 1024 %}
                                        {{ db_info.size }} –±–∞–π—Ç
                                    {% elif db_info.size < 1024*1024 %}
                                        {{ "%.1f"|format(db_info.size/1024) }} –ö–ë
                                    {% else %}
                                        {{ "%.1f"|format(db_info.size/(1024*1024)) }} –ú–ë
                                    {% endif %}
                                </p>
                                <p class="mb-1">
                                    <strong>–ò–∑–º–µ–Ω–µ–Ω–∞:</strong>
                                    {{ db_info.modified.strftime('%d.%m.%Y –≤ %H:%M') }}
                                </p>
                                <p class="mb-0">
                                    <strong>–¢–∞–±–ª–∏—Ü:</strong> {{ db_info.tables_count }}
                                </p>
                                {% if db_info.records_count %}
                                <hr class="my-2">
                                <small class="text-muted">
                                    <strong>–ó–∞–ø–∏—Å–µ–π:</strong><br>
                                    {% for table, count in db_info.records_count.items() %}
                                        {{ table }}: {{ count }}<br>
                                    {% endfor %}
                                </small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0">üíæ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø</h6>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-3">
                                    –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
                                </p>
                                <form method="POST" action="{{ url_for('backup_create') }}"
                                      onsubmit="return confirm('–°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?')">
                                    <button type="submit" class="btn btn-success w-100">
                                        <i class="bi bi-download"></i> –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-warning" role="alert">
                    <i class="bi bi-exclamation-triangle"></i>
                    –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î.
                </div>
                {% endif %}

                <!-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞ -->
                <div class="card border-warning mb-3">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0">üìÇ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Ñ–∞–π–ª–∞</h6>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-3">
                            –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–π —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞ (.db) –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
                            <strong class="text-warning">–í–Ω–∏–º–∞–Ω–∏–µ:</strong> —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã!
                        </p>
                        <form method="POST" action="{{ url_for('backup_restore') }}"
                              enctype="multipart/form-data"
                              onsubmit="return confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')">
                            <div class="input-group">
                                <input type="file"
                                       class="form-control"
                                       name="backup_file"
                                       accept=".db"
                                       required>
                                <button type="submit" class="btn btn-warning">
                                    <i class="bi bi-upload"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞
                                </button>
                            </div>
                            <div class="form-text mt-2">
                                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –±—ç–∫–∞–ø–æ–≤ –∏–∑ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                            </div>
                        </form>
                    </div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±—ç–∫–∞–ø–æ–≤ -->
                {% if backups %}
                <div class="card border-secondary">
                    <div class="card-header">
                        <h6 class="mb-0">üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –±—ç–∫–∞–ø—ã ({{ backups|length }})</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                        <th>–†–∞–∑–º–µ—Ä</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for backup in backups %}
                                    <tr>
                                        <td>
                                            <span class="fw-bold">{{ backup.modified.strftime('%d.%m.%Y') }}</span><br>
                                            <small class="text-muted">{{ backup.modified.strftime('%H:%M:%S') }}</small>
                                        </td>
                                        <td>
                                            {% if backup.size < 1024 %}
                                                {{ backup.size }} –±–∞–π—Ç
                                            {% elif backup.size < 1024*1024 %}
                                                {{ "%.1f"|format(backup.size/1024) }} –ö–ë
                                            {% else %}
                                                {{ "%.1f"|format(backup.size/(1024*1024)) }} –ú–ë
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <form method="POST"
                                                      action="{{ url_for('backup_restore_from_existing', filename=backup.filename) }}"
                                                      style="display: inline;"
                                                      onsubmit="return confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î –∏–∑ –±—ç–∫–∞–ø–∞ {{ backup.filename }}? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã!')">
                                                    <button type="submit" class="btn btn-outline-success" title="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —ç—Ç–æ–≥–æ –±—ç–∫–∞–ø–∞">
                                                        <i class="bi bi-arrow-clockwise"></i>
                                                    </button>
                                                </form>
                                                <a href="{{ url_for('backup_download', filename=backup.filename) }}"
                                                   class="btn btn-outline-primary" title="–°–∫–∞—á–∞—Ç—å –±—ç–∫–∞–ø">
                                                    <i class="bi bi-download"></i>
                                                </a>
                                                <form method="POST"
                                                      action="{{ url_for('backup_delete', filename=backup.filename) }}"
                                                      style="display: inline;"
                                                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –±—ç–∫–∞–ø {{ backup.filename }}?')">
                                                    <button type="submit" class="btn btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å –±—ç–∫–∞–ø">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="bi bi-info-circle"></i>
                                <strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong>
                                <i class="bi bi-arrow-clockwise text-success"></i> - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å,
                                <i class="bi bi-download text-primary"></i> - —Å–∫–∞—á–∞—Ç—å,
                                <i class="bi bi-trash text-danger"></i> - —É–¥–∞–ª–∏—Ç—å
                            </small>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-info" role="alert">
                    <i class="bi bi-info-circle"></i>
                    –ë—ç–∫–∞–ø—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –±—ç–∫–∞–ø –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}